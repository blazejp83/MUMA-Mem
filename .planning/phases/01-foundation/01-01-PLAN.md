---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - openclaw.plugin.json
  - src/types/note.ts
  - src/types/store.ts
  - src/types/index.ts
  - src/embedding/types.ts
  - src/llm/types.ts
  - src/config.ts
autonomous: true
---

<objective>
Initialize the MUMA-Mem project as a standalone npm package and define all core type interfaces that Phase 1 plans depend on.

Purpose: Every other plan in this phase imports from these types. This plan creates the foundation: package scaffolding, TypeScript config, core data schemas, storage/embedding interfaces, and the OpenClaw plugin manifest with full config schema.

Output: Compilable TypeScript project with all interfaces defined, plugin manifest ready, zero implementation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@MUMA-Mem-Architecture.md
@MUMA-Mem-OpenClaw-Integration-Analysis.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize npm package with TypeScript and ESM</name>
  <files>package.json, tsconfig.json, .gitignore, src/index.ts</files>
  <action>
  1. Run `pnpm init` in project root (/home/blaze/repos/promem/)
  2. Set in package.json:
     - "name": "@openclaw/memory-muma"
     - "version": "0.1.0"
     - "type": "module"
     - "main": "dist/index.js"
     - "types": "dist/index.d.ts"
     - "exports": { ".": { "import": "./dist/index.js", "types": "./dist/index.d.ts" } }
     - "engines": { "node": ">=22.0.0" }
     - "scripts": { "build": "tsc", "typecheck": "tsc --noEmit" }
  3. Install dev dependencies: `pnpm add -D typescript@~5.9 @types/node@22`
  4. Create tsconfig.json:
     - target: "ES2022"
     - module: "NodeNext"
     - moduleResolution: "NodeNext"
     - strict: true
     - outDir: "dist"
     - rootDir: "src"
     - declaration: true
     - esModuleInterop: true
     - skipLibCheck: true
     - include: ["src"]
  5. Create directory structure:
     - src/types/
     - src/store/
     - src/embedding/
     - src/llm/
     - test/
  6. Create src/index.ts with a placeholder export: `export const VERSION = "0.1.0";`
  7. Update .gitignore to include: node_modules/, dist/, *.tsbuildinfo, .env
     Keep existing .planning/ and research files. Do NOT delete any existing files in the project root (*.md, *.jpg, research/, etc.).
  </action>
  <verify>
  - `pnpm run typecheck` passes with no errors
  - `pnpm run build` produces dist/index.js and dist/index.d.ts
  - package.json has "type": "module" and correct exports
  </verify>
  <done>TypeScript ESM project compiles successfully, directory structure exists</done>
</task>

<task type="auto">
  <name>Task 2: Define core types and interfaces</name>
  <files>src/types/note.ts, src/types/store.ts, src/types/index.ts, src/embedding/types.ts, src/llm/types.ts</files>
  <action>
  **src/types/note.ts** — Note schema from Architecture doc Section 5.2, extended with all metadata fields (PLUG-08):

  ```typescript
  export type Visibility = "open" | "scoped" | "private" | "user-only";
  export type MemorySource = "experience" | "told" | "inferred";
  export type WriteOperation = "ADD" | "UPDATE" | "DELETE" | "NOOP";

  export interface Note {
    id: string;                    // UUID v4
    content: string;               // Natural language memory content
    context: string;               // LLM-generated semantic summary
    keywords: string[];            // Ordered by salience
    tags: string[];                // Categorical labels
    embedding: Float32Array;       // Dense vector from embedding provider
    links: string[];               // Bidirectional note IDs (JSON adjacency)
    created_at: string;            // ISO 8601 timestamp
    updated_at: string;            // ISO 8601 timestamp
    created_by: string;            // Agent ID that created this memory
    user_id: string;               // User isolation key
    domain: string;                // Topical classification (e.g., "business/sales")
    visibility: Visibility;        // Access scope
    access_count: number;          // Total retrievals
    access_log: string[];          // ISO 8601 timestamps of each retrieval
    activation: number;            // Current activation score
    half_life: number;             // Hours until retention drops to 50%
    importance: number;            // 0-1, LLM-scored at creation
    source: MemorySource;          // Origin type
    confidence: number;            // 0-1
    version: number;               // Incremented on update
    pinned: boolean;               // Exempt from decay if true
  }

  // For creating new notes (fields auto-populated by system)
  export interface NoteCreate {
    content: string;
    context?: string;
    keywords?: string[];
    tags?: string[];
    embedding: Float32Array;
    links?: string[];
    created_by: string;
    user_id: string;
    domain?: string;
    visibility?: Visibility;
    importance?: number;
    source?: MemorySource;
    confidence?: number;
  }

  export interface NoteUpdate {
    content?: string;
    context?: string;
    keywords?: string[];
    tags?: string[];
    embedding?: Float32Array;
    links?: string[];
    domain?: string;
    visibility?: Visibility;
    importance?: number;
    confidence?: number;
    pinned?: boolean;
  }
  ```

  **src/types/store.ts** — MemoryStore interface:

  ```typescript
  import type { Note, NoteCreate, NoteUpdate } from "./note.js";

  export interface VectorSearchOptions {
    query: Float32Array;           // Query embedding
    userId: string;                // User isolation
    topK?: number;                 // Default 10
    minScore?: number;             // Minimum similarity threshold
  }

  export interface VectorSearchResult {
    note: Note;
    score: number;                 // Similarity score
  }

  export interface MemoryStore {
    // Lifecycle
    initialize(): Promise<void>;
    close(): Promise<void>;

    // CRUD
    create(note: NoteCreate): Promise<Note>;
    read(id: string, userId: string): Promise<Note | null>;
    update(id: string, userId: string, updates: NoteUpdate): Promise<Note | null>;
    delete(id: string, userId: string): Promise<boolean>;

    // Search
    search(options: VectorSearchOptions): Promise<VectorSearchResult[]>;

    // Bulk operations
    listByUser(userId: string, options?: { limit?: number; offset?: number }): Promise<Note[]>;
    countByUser(userId: string): Promise<number>;

    // Metadata
    readonly backend: "redis" | "sqlite";
    readonly dimensions: number | null;  // null until first vector stored
  }
  ```

  **src/embedding/types.ts** — EmbeddingProvider interface:

  ```typescript
  export interface EmbeddingProvider {
    embed(text: string): Promise<Float32Array>;
    embedBatch(texts: string[]): Promise<Float32Array[]>;
    readonly dimensions: number;
    readonly modelName: string;
    initialize(): Promise<void>;
    close(): Promise<void>;
  }
  ```

  **src/llm/types.ts** — LLM provider config type (config only, implementation in Phase 2):

  ```typescript
  export interface LLMProviderConfig {
    provider: string;              // "openai", "anthropic", "ollama", etc.
    model: string;                 // Model name
    apiKey?: string;               // API key (can use env var reference)
    baseUrl?: string;              // Custom base URL
    temperature?: number;          // Default 0.7
    maxTokens?: number;            // Default 1024
  }
  ```

  **src/types/index.ts** — Re-export everything:
  ```typescript
  export * from "./note.js";
  export * from "./store.js";
  ```

  All imports must use `.js` extensions for ESM compatibility (TypeScript NodeNext resolution).
  </action>
  <verify>`pnpm run typecheck` passes — all types compile with no errors</verify>
  <done>All core interfaces defined and exported. Note schema includes all PLUG-08 metadata fields. MemoryStore has CRUD + vector search + lifecycle. EmbeddingProvider has embed + dimensions. LLMProviderConfig is ready for Phase 2.</done>
</task>

<task type="auto">
  <name>Task 3: Create plugin manifest and Zod config schema</name>
  <files>openclaw.plugin.json, src/config.ts</files>
  <action>
  1. Install Zod: `pnpm add zod`

  2. **openclaw.plugin.json** — Plugin manifest matching OpenClaw's PluginManifest type:
  ```json
  {
    "id": "memory-muma",
    "name": "MUMA-Mem",
    "description": "Multi-user multi-agent memory with ACT-R activation, Ebbinghaus forgetting, and semantic note linking",
    "version": "0.1.0",
    "kind": "memory",
    "configSchema": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "redis": {
          "type": "object",
          "properties": {
            "url": { "type": "string", "default": "redis://localhost:6379" },
            "prefix": { "type": "string", "default": "muma:" }
          }
        },
        "sqlite": {
          "type": "object",
          "properties": {
            "path": { "type": "string", "description": "SQLite database file path. Defaults to ~/.openclaw/memory-muma.db" }
          }
        },
        "embedding": {
          "type": "object",
          "properties": {
            "provider": { "type": "string", "enum": ["local", "openai"], "default": "local" },
            "model": { "type": "string", "default": "Xenova/all-MiniLM-L6-v2" },
            "apiKey": { "type": "string" },
            "baseUrl": { "type": "string" },
            "dimensions": { "type": "number" }
          }
        },
        "llm": {
          "type": "object",
          "properties": {
            "provider": { "type": "string" },
            "model": { "type": "string" },
            "apiKey": { "type": "string" },
            "baseUrl": { "type": "string" },
            "temperature": { "type": "number", "default": 0.7 },
            "maxTokens": { "type": "number", "default": 1024 }
          }
        },
        "activation": {
          "type": "object",
          "properties": {
            "contextWeight": { "type": "number", "default": 11.0 },
            "noiseStddev": { "type": "number", "default": 1.2 },
            "decayParameter": { "type": "number", "default": 0.5 },
            "retrievalThreshold": { "type": "number", "default": 0.0 }
          }
        },
        "decay": {
          "type": "object",
          "properties": {
            "sweepIntervalMinutes": { "type": "number", "default": 60 },
            "pruneThreshold": { "type": "number", "default": -2.0 },
            "hardPruneThreshold": { "type": "number", "default": -5.0 },
            "minAgeHours": { "type": "number", "default": 72 },
            "maxAgeHours": { "type": "number", "default": 720 }
          }
        },
        "visibility": {
          "type": "object",
          "properties": {
            "defaultVisibility": { "type": "string", "enum": ["open", "scoped", "private", "user-only"], "default": "scoped" },
            "domainRules": { "type": "object", "additionalProperties": { "type": "string", "enum": ["open", "scoped", "private", "user-only"] } },
            "domainBoost": { "type": "number", "default": 1.0 }
          }
        },
        "agentMemory": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "domains": { "type": "array", "items": { "type": "string" } },
              "canSeePrivate": { "type": "boolean", "default": false }
            },
            "required": ["domains"]
          }
        },
        "defaultAgentMemory": {
          "type": "object",
          "properties": {
            "domains": { "type": "array", "items": { "type": "string" }, "default": ["*"] },
            "canSeePrivate": { "type": "boolean", "default": false }
          }
        }
      }
    },
    "uiHints": {
      "redis.url": { "label": "Redis URL", "placeholder": "redis://localhost:6379" },
      "embedding.apiKey": { "label": "Embedding API Key", "sensitive": true },
      "llm.apiKey": { "label": "LLM API Key", "sensitive": true }
    }
  }
  ```

  3. **src/config.ts** — Zod schema that mirrors the JSON schema above. This is used for runtime validation inside the plugin:

  Define Zod schemas for each config section (redis, sqlite, embedding, llm, activation, decay, visibility, agentMemory, defaultAgentMemory). Use `.default()` for all defaults. Export the parsed config type as `MumaConfig`.

  The Zod schema must handle:
  - All defaults from the JSON schema
  - Optional sections (the entire config object can be empty/undefined)
  - Visibility enum validation
  - Agent memory profile structure

  Export: `MumaConfigSchema` (the Zod schema), `MumaConfig` (the inferred type).
  </action>
  <verify>
  - `pnpm run typecheck` passes
  - openclaw.plugin.json is valid JSON
  - Zod schema parses `{}` (empty config) without errors (all defaults apply)
  </verify>
  <done>Plugin manifest declares memory-muma as kind: "memory" with full config schema. Zod runtime validation matches manifest. Empty config produces valid defaults.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm run typecheck` passes with zero errors
- [ ] `pnpm run build` produces dist/ with all type declarations
- [ ] openclaw.plugin.json is valid JSON with id, kind, configSchema
- [ ] All interfaces (Note, MemoryStore, EmbeddingProvider, LLMProviderConfig) are exported from src/types/index.ts or their respective modules
- [ ] MumaConfigSchema.parse({}) returns valid config with all defaults
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- TypeScript compiles with strict mode
- No runtime dependencies except zod (everything else is types)
- Note schema includes all 22 fields from Architecture doc
- MemoryStore interface covers CRUD + vector search + lifecycle
- Config schema handles all tunable parameters from Architecture doc
  </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
